#!/usr/bin/env ruby

require 'monitoring_dashboard/aws_billing/processor'
require 'monitoring_dashboard/aws_billing/report'

access_key = ARGV[0]
secret_key = ARGV[1]
custom_log_dir = ARGV[2]
days_from_now = ARGV[3].to_i
days_to_backdate = (ARGV[4] || 2).to_i
exit 128 if access_key.nil? || secret_key.nil?

report = MonitoringDashboard::AwsBilling::Report.new access_key, secret_key, custom_log_dir
cost_processor = MonitoringDashboard::AwsBilling::Processor.new report

cost_processor.daily_cost_influx_format(days_from_now, days_to_backdate)
